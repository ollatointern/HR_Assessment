# HR_Assessment

import { useEffect, useState } from "react";
import axios from "axios";
import jsPDF from "jspdf";

const DownloadSummary = () => {
const [results, setResults] = useState({});
const userResult = JSON.parse(localStorage.getItem("user"));
const userId = userResult.id;

useEffect(() => {
const fetchResults = async () => {
try {
const response = await axios.get(
`http://localhost:5000/api/auth/user/${userId}`
);
setResults(response.data);
console.log("Fetched results:", response.data);
} catch (error) {
console.error("Error fetching results:", error);
}
};

    fetchResults();

}, [userId]);

const generatePDF = () => {
const pdf = new jsPDF({
orientation: "landscape",
unit: "mm",
format: "a4",
});
const title = `Ollato Mind Mapping Summary Report: ${userResult.name}`;
pdf.setFontSize(24);
pdf.text(title, 105, 20, { align: "center", bold: true });

    // Add a header section
    pdf.setFontSize(18);
    pdf.text(`Generated for: ${userResult.name}`, 14, 30);
    pdf.text(`Date: ${new Date().toLocaleDateString()}`, 14, 35);

    // Define columns
    const columns = [
      "Domains",
      "Excellent",
      "Good",
      "Moderate",
      "Concern",
      "Danger",
      "Serious",
    ];

    const totalWidth = pdf.internal.pageSize.getWidth() - 28;
    const colWidth = totalWidth / columns.length;
    const barWidth = colWidth * 0.6;
    let startX = 14;
    let startY = 50;

    // Draw headers
    pdf.setFontSize(12);
    pdf.setFillColor(200, 200, 200);
    pdf.rect(14, startY - 10, totalWidth, 20, "F");
    pdf.setFillColor(0, 0, 0);
    columns.forEach((col, index) => {
      pdf.text(col, startX + colWidth / 2, startY, { align: "center" });
      startX += colWidth;

      pdf.setDrawColor(0);
      pdf.line(startX, startY - 10, startX, startY + 10);
    });

    // Draw a horizontal line under the header
    startY += 10;
    pdf.setDrawColor(0);
    pdf.line(14, startY, totalWidth + 14, startY);

    // Prepare data for PDF
    startY += 10;
    pdf.setFontSize(10);

    const categories = {
      Excellent: [],
      Good: [],
      Moderate: [],
      Concern: [],
      Danger: [],
      Serious: [],
    };

    const checkPageHeight = () => {
      if (startY > 180) {
        // Adjust this threshold if needed
        pdf.addPage();
        startY = 20; // Reset Y position for new page
      }
    };

    Object.entries(results).forEach(([domain, score]) => {
      checkPageHeight(); // Ensure content continues on the next page if necessary
      startX = 14;
      pdf.text(domain, startX + colWidth / 2, startY, { align: "center" });

      // Determine the bar color and column index
      let barColor;
      let columnIndex;

      if (score >= 80) {
        barColor = [0, 128, 0]; // Dark green
        columnIndex = 1; // Excellent
        categories.Excellent.push(domain);
      } else if (score >= 60) {
        barColor = [144, 238, 144]; // Light green
        columnIndex = 2; // Good
        categories.Good.push(domain);
      } else if (score >= 50) {
        barColor = [255, 255, 0]; // Yellow
        columnIndex = 3; // Moderate
        categories.Moderate.push(domain);
      } else if (score >= 40) {
        barColor = [211, 211, 211]; // Light gray
        columnIndex = 4; // Concern
        categories.Concern.push(domain);
      } else {
        barColor = [255, 0, 0]; // Red
        columnIndex = 5; // Serious
        categories.Serious.push(domain);
      }

      // Calculate the middle position for the bar
      const barX = startX + columnIndex * colWidth + (colWidth - barWidth) / 2;

      // Draw the colored bar in the appropriate column
      pdf.setFillColor(...barColor);
      pdf.rect(barX, startY - 6, barWidth, 10, "F");

      // Draw vertical line after the current column
      pdf.setDrawColor(0);
      pdf.line(startX + colWidth, startY - 10, startX + colWidth, startY + 10);

      startX += colWidth;

      // Draw horizontal line at the end of the row
      pdf.line(14, startY + 10, totalWidth + 14, startY + 10);
      startY += 20; // Increase row height for better spacing
    });

    // Space before categories
    startY += 10;
    checkPageHeight(); // Check before printing categories

    // Output categories and their domains
    pdf.setFontSize(12);
    pdf.text("Categories:", 14, startY);
    startY += 10;
    Object.entries(categories).forEach(([category, domains]) => {
      checkPageHeight(); // Ensure enough space
      pdf.text(category, 14, startY);
      pdf.text(domains.join(", ") || "None", 80, startY);
      startY += 10;
    });

    // Add some whitespace
    startY += 20;

    // Add a footer section
    checkPageHeight();
    pdf.setFontSize(10);
    pdf.text("Generated by Ollato Mind Mapping", 14, startY);
    pdf.text("Date: " + new Date().toLocaleDateString(), 14, startY + 5);

    // Save the PDF
    pdf.save("summary_report.pdf");

};

return (

<div>
<button
        onClick={generatePDF}
        className="bg-blue-500 text-white px-4 py-2 rounded"
      >
Download Summary
</button>
</div>
);
};

export default DownloadSummary;
